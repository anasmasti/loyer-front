<div *ngFor="let foncier of foncierById?.lieu">
  <span class="main-txt"
    >{{ foncier?.lieu.type_lieu }} •
    {{
      foncier?.lieu.code_lieu
        ? foncier?.lieu.code_lieu
        : foncier?.lieu.attached_DR.code_lieu
    }}
    • {{ foncier?.lieu.intitule_lieu }}</span
  >
</div>

<!--Début de Div qui contient le formulaire form-contrat-->
<div id="form_content" class="form-box mt-2">
  <!--Début Formulaire form-contrat-->
  <form [formGroup]="contratForm" enctype="multipart/form-data">
    <div class="w-100 d-flex justify-content-center">
      <div *ngIf="errors" class="error-alert p-2 my-2">{{ errors }}</div>
      <!-- alert de reussite -->
      <div *ngIf="postDone" class="done-alert p-2 my-2">{{ PostSucces }}</div>
      <div *ngIf="updateDone" class="done-alert p-2 my-2">
        {{ updateSucces }}
      </div>
    </div>

    <!--Début 1er Row-->
    <div class="row">
      <!-- Calcul retenue a la source par mois/ total brut loyer / total net loyer -->
      <input
        type="hidden"
        class="form-control"
        [value]="duree"
        formControlName="duree"
      />
      <input
        type="hidden"
        class="form-control"
        [value]="retunue_source_par_mois"
        formControlName="retunue_source_par_mois"
      />
      <input
        type="hidden"
        class="form-control"
        [value]="totalBrutLoyer"
        formControlName="total_montant_brut_loyer"
      />
      <input
        type="hidden"
        class="form-control"
        [value]="totalNetLoyer"
        formControlName="total_montant_net_loyer"
      />
      <!-- Montant Avance Tax -->
      <input
        type="hidden"
        class="form-control"
        [value]="montant_avance_tax_"
        formControlName="montant_avance_tax"
      />

      <!-- Validation inputs -->
      <input
        type="hidden"
        class="form-control btn success-btn"
        formControlName="validation1_DMG"
      />
      <input
        type="hidden"
        class="form-control btn success-btn"
        formControlName="validation2_DAJC"
      />
      <input
        type="hidden"
        class="form-control btn success-btn"
        formControlName="numero_contrat"
      />

      <ng-container *ngIf="!update || (contrat.etat_contrat?.libelle !== 'Actif' && update)">
        <div class="col-lg-3 form-group mt-4">
          <label for="">Pièce jointe</label>
          <input
            type="file"
            class="form-control btn success-btn"
            formControlName="piece_jointe"
            accept=".pdf"
            (change)="onFileSelected($event, 'piece_joint_contrat')"
            [ngClass]="{
              'is-invalid': checkInputsValidation(piece_jointe),
              'is-valid': !piece_jointe?.invalid
            }"
            multiple
          />
          <!-- (change)="onFileSelected($event,'piece_joint_contrat')" -->

          <!-- Error Message  -->
          <div class="" *ngIf="checkInputsValidation(piece_jointe)">
            <p class="danger-txt" *ngIf="piece_jointe?.errors?.required">
              Veuillez choisir une pièce jointe
            </p>
          </div>
        </div>

        <div class="col-lg-3 form-group mt-4">
          <label for=""
            >Date de début du loyer <span class="danger-txt">*</span></label
          >
          <input
            type="date"
            [(ngModel)]="date_debut_loyer_"
            class="form-control rounded-pill"
            (change)="reinitialiserDateDebut()"
            formControlName="date_debut_loyer"
            required
            [ngClass]="{
              'is-invalid': checkInputsValidation(date_debut_loyer),
              'is-valid': !date_debut_loyer?.invalid
            }"
          />

          <!-- Error Message  -->
          <div class="" *ngIf="checkInputsValidation(date_debut_loyer)">
            <p class="danger-txt" *ngIf="date_debut_loyer?.errors?.required">
              Veuillez remplir ce champ
            </p>
          </div>
        </div>

        <div class="col-lg-3 form-group mt-4">
          <label for=""
            >Montant du loyer <span class="danger-txt">*</span></label
          >
          <input
            type="number"
            [(ngModel)]="montantLoyer"
            class="form-control rounded-pill"
            formControlName="montant_loyer"
            [ngClass]="{
              'is-invalid': checkInputsValidation(montant_loyer),
              'is-valid': !montant_loyer?.invalid
            }"
            (keyup)="calculDate()"
          />
          <!-- (keyup)="calculTaxeNonComprise();calculMontantLoyerTTC()" -->
          <!-- <div class="col-lg-3 form-group mt-4">
            <label for="">Montant du loyer <span class="danger-txt">*</span></label>
            <input type="number" [(ngModel)]="montantLoyer" (keyup)="calculDate()" class="form-control rounded-pill"
              formControlName="montant_loyer" [ngClass]="{
                'is-invalid': checkInputsValidation(montant_loyer),
                'is-valid': !montant_loyer?.invalid
              }"  />
               (keyup)="calculTaxeNonComprise();calculMontantLoyerTTC()" -->

          <!-- Error Message  -->
          <!-- <div class="" *ngIf="checkInputsValidation(montant_loyer)">
              <p class="danger-txt" *ngIf="montant_loyer?.errors?.required">
                Veuillez remplir ce champ
              </p>
            </div>
          </div> -->

          <!-- Error Message  -->
          <div class="" *ngIf="checkInputsValidation(montant_loyer)">
            <p class="danger-txt" *ngIf="montant_loyer?.errors?.required">
              Veuillez remplir ce champ
            </p>
          </div>
        </div>

        <div class="col-lg-3 form-group mt-4">
          <label for="">Nombre de part <span class="danger-txt">*</span></label>
          <input
            type="number"
            class="form-control rounded-pill"
            formControlName="nombre_part"
            [ngClass]="{
              'is-invalid': checkInputsValidation(nombre_part),
              'is-valid': !nombre_part?.invalid
            }"
          />

          <!-- Error Message  -->
          <div class="" *ngIf="checkInputsValidation(nombre_part)">
            <p class="danger-txt" *ngIf="nombre_part?.errors?.required">
              Veuillez remplir ce champ
            </p>
          </div>
        </div>

        <div class="col-lg-3 form-group mt-4">
          <label for="">Taxe d’édilité comprise dans le loyer</label>
          <input
            type="text"
            class="form-control rounded-pill"
            formControlName="taxe_edilite_comprise_loyer"
          />
        </div>

        <div class="col-lg-3 form-group mt-4">
          <label for="">Taxe d’édilité non comprise dans le loyer</label>
          <input
            type="text"
            class="form-control rounded-pill"
            formControlName="taxe_edilite_noncomprise_loyer"
          />
        </div>

        <!-- <div class="col-lg-3 form-group mt-4">
            <label for="">Taxe d’édilité comprise dans le loyer</label>
            <input type="text" class="form-control rounded-pill" formControlName="taxe_edilite_comprise_loyer" (keyup)="calculTaxeNonComprise()"/>
          </div> -->

        <!-- //////////// The last solution of Taxe d'édilité ////////////////// -->

        <!-- <div class="col-lg-4 form-group mt-4">
          <label for="">Taxe d’édilité non comprise dans le loyer</label>
          <input type="text" [value]="taxNonComprise" class="form-control rounded-pill" formControlName="taxe_edilite_noncomprise_loyer" readonly/>
       </div>
        <div class="row">
          <div class="col-lg-4 form-group mt-4">
            <label for="">Montant du loyer TTC</label>
            <input type="number" class="form-control rounded-pill"
              formControlName="montant_loyer_ttc" [value]="montantLoyerTTC"  readonly/>
          </div>
    
          <div class="col-lg-4 form-group mt-4">
            <label for="">Taxe d’édilité comprise dans le loyer</label>
            <input type="text" class="form-control rounded-pill" formControlName="taxe_edilite_comprise_loyer" (keyup)="calculTaxeNonComprise()" [value]="taxNonComprise" readonly/>
          </div>
        </div> -->
        <!-- ///////////////////////////////////////////////// -->

        <div class="col-lg-3 form-group mt-4">
          <label for=""
            >Périodicité de paiement <span class="danger-txt">*</span></label
          >
          <!-- <input type="text" class="form-control rounded-pill" formControlName="periodicite_paiement" /> -->
          <select
            class="form-select rounded-pill"
            formControlName="periodicite_paiement"
            [ngClass]="{
              'is-invalid': checkInputsValidation(periodicite_paiement),
              'is-valid': !periodicite_paiement?.invalid
            }"
            [(ngModel)]="periodicite"
            (change)="reinitialiserDates()"
          >
            <option value="mensuelle">Mensuelle</option>
            <option value="trimestrielle">Trimestrielle</option>
            <option value="annuelle">Annuelle</option>
          </select>
          <!-- Error Message  -->
          <div class="" *ngIf="checkInputsValidation(periodicite_paiement)">
            <p
              class="danger-txt"
              *ngIf="periodicite_paiement?.errors?.required"
            >
              Veuillez remplir ce champ
            </p>
          </div>
        </div>

        <!-- <div class="col-lg-3 form-group mt-4">
          <label for="">Durée de location</label>
          <input type="number" class="form-control rounded-pill" formControlName="duree_location" [ngClass]="{
            'is-invalid': checkInputsValidation(duree_location),
            'is-valid': !duree_location?.invalid
          }" />
            --Error Message-- 
          <div class="" *ngIf="checkInputsValidation(duree_location)">
            <p class="danger-txt" *ngIf="duree_location?.errors?.required">
              Veuillez remplir ce champ
            </p>
          </div>
        </div> -->

        <div class="col-lg-3 form-group mt-4">
          <label for="">Date fin de contrat de bail</label>
          <input
            type="date"
            class="form-control rounded-pill"
            formControlName="date_fin_contrat"
            [ngClass]="{
              'is-invalid': checkInputsValidation(date_fin_contrat),
              'is-valid': !date_fin_contrat?.invalid
            }"
          />
          <!-- Error Message  -->
          <!-- <div class="" *ngIf="checkInputsValidation(date_fin_contrat)">
            <p class="danger-txt" *ngIf="date_fin_contrat?.errors?.required">
              Veuillez remplir ce champ
            </p>
          </div> -->
        </div>

        <!-- Replace Déclaration d’option with Paiement Spontanée de TSR  -->
        <!-- <div class="col-lg-3 form-group mt-4">
          <label for="">Paiement spontané de TSR </label>
          <select
            class="form-select rounded-pill"
            [(ngModel)]="hasDeclarationOption"
            formControlName="declaration_option"
          >
            <option value="oui">Oui</option>
            <option value="non">Non</option>
          </select>
        </div> -->

        <!-- <div class="col-lg-3 form-group mt-4">
          <label for="">Taux de l’impôt</label>
          <input type="text" class="form-control rounded-pill" [value]="tauxImpot + '%'" formControlName="taux_impot"
            readonly>
        </div> -->

        <!-- <div class="col-lg-3 form-group mt-4">
          <label for="">Retenue à la source (Annuel) </label>
          <input type="text" [value]="retenueSource" class="form-control rounded-pill" formControlName="retenue_source"
            readonly>
        </div> -->

        <!-- <div class="col-lg-3 form-group mt-4">
          <label for="">Montant après impôt</label>
          <input type="number" class="form-control rounded-pill" [value]="montantApresImpot"
            formControlName="montant_apres_impot" readonly>
        </div> -->

        <div class="col-lg-3 form-group mt-4">
          <label for="">Montant de la caution</label>
          <input
            type="number"
            class="form-control rounded-pill"
            [(ngModel)]="montantCaution"
            (keyup)="calculEffortCaution()"
            formControlName="montant_caution"
          />
        </div>

        <div class="col-lg-3 form-group mt-4">
          <label for="">Durée de la caution</label>
          <input
            type="text"
            class="form-control rounded-pill"
            [(ngModel)]="dureeCaution"
            formControlName="duree_caution"
            readonly
          />
          <p class="danger-txt" *ngIf="hasErrorEffort">
            Montant de caution erroné
          </p>
        </div>

        <div class="col-lg-3 form-group mt-4">
          <label for="">Date de reprise de la caution</label>
          <input
            type="date"
            class="form-control rounded-pill"
            formControlName="date_reprise_caution"
            [ngClass]="{
              'is-invalid': checkInputsValidation(date_reprise_caution),
              'is-valid': !date_reprise_caution?.invalid
            }"
          />
          <!-- Error Message  -->
          <!-- <div class="" *ngIf="checkInputsValidation(date_reprise_caution)">
            <p class="danger-txt" *ngIf="date_reprise_caution?.errors?.required">
              Veuillez remplir ce champ
            </p>
          </div> -->
        </div>

        <div class="col-lg-3 form-group mt-4">
          <label for="">Statut de la caution</label>
          <input
            type="text"
            [(ngModel)]="statutCaution"
            class="form-control rounded-pill"
            formControlName="statut_caution"
            readonly
          />
        </div>

        <div class="col-lg-3 form-group mt-4">
          <label for=""
            >Durée de l’avance ({{ periodicite ? periodicite : "--" }})</label
          >
          <input
            type="number"
            class="form-control rounded-pill"
            [(ngModel)]="dureeAvance"
            (keyup)="calculDate()"
            formControlName="duree_avance"
            [readonly]="periodicite ? false : true"
          />
        </div>

        <div class="col-lg-3 form-group mt-4">
          <label for="">Date fin de l’avance</label>
          <input
            type="date"
            class="form-control rounded-pill"
            [value]="formattedDateFinAvance"
            formControlName="date_fin_avance"
            readonly
          />
        </div>

        <div class="col-lg-3 form-group mt-4">
          <label for="">Date 1er paiement</label>
          <input
            type="date"
            class="form-control rounded-pill"
            [value]="datePremierPaiement"
            formControlName="date_premier_paiement"
            readonly
          />
        </div>

        <div class="col-lg-3 form-group mt-4">
          <label for="">Montant de l’avance</label>
          <input
            type="number"
            class="form-control rounded-pill"
            formControlName="montant_avance"
            [(ngModel)]="montantAvance"
            (keyup)="calculMontantAvanceTax()"
            [readonly]="true"
          />
        </div>

        <!-- <div class="col-lg-3 form-group mt-4">
        <label for="">N° d’engagement de la dépense</label>
        <input type="text" class="form-control rounded-pill" formControlName="n_engagement_depense">
      </div> -->

        <!-- <div class="col-lg-3 form-group mt-4" >
        <label for="">Echéance de révision du loyer</label>
        <input type="text" class="form-control rounded-pill" formControlName="echeance_revision_loyer">
      </div> -->
      </ng-container>

      <div
        *ngIf="update && contrat.etat_contrat?.libelle === 'Actif'"
        class="form-group mt-4"
      >
        <label for="">Statut contrat</label>
        <select
          class="form-select rounded-pill"
          formControlName="etat_contrat_libelle"
          [(ngModel)]="selectedEtatContrat"
          (change)="showEtatSection($event)"
        >
          <!-- <option value="Actif">Actif</option> -->
          <!--  -->
          <option
            *ngIf="this.contrat.validation2_DAJC && (userRoles.includes('CDGSP') || userRoles.includes('CSLA'))"
            [value]="
              selectedEtatContrat === 'Avenant' ? selectedEtatContrat : 'Avenant'
            "
          >
            A créer avenant
          </option>
          <option *ngIf="this.contrat.validation2_DAJC && userRoles.includes('DAJC')" value="Suspendu">
            À suspendre
          </option>
          <option *ngIf="this.contrat.validation2_DAJC && (userRoles.includes('DAJC') || userRoles.includes('CDGSP') || userRoles.includes('CSLA'))" value="Résilié">
            À résilier
          </option>
        </select>
      </div>

      <div *ngIf="!update && foncier" class="col-lg-3 form-group mt-4">
        <label for="">Addresse du foncier</label>
        <input
          type="hidden"
          [(ngModel)]="foncier._id"
          formControlName="foncier"
        />
        <p>
          <strong>
            {{ foncier.adresse }}
          </strong>
        </p>
      </div>

      <div *ngIf="!update && foncier" class="col-lg-3 form-group mt-4">
        <input
          type="hidden"
          [(ngModel)]="foncier.lieu"
          formControlName="lieu"
        />
      </div>

      <div *ngIf="update" class="col-lg-3 form-group mt-4">
        <input type="hidden" formControlName="lieu" />
        <input type="hidden" formControlName="foncier" />
      </div>

      <div class="mt-4">
        <div class="form-box mt-2">
          <div *ngIf="selectedEtatContrat === 'Avenant'; then AV"></div>
          <div *ngIf="selectedEtatContrat === 'Suspendu'; then SUS"></div>
          <div *ngIf="selectedEtatContrat === 'Résilié'; then RES"></div>
        </div>
      </div>

      <!-- Template Avenant start -->
      <ng-template #AV>
        <h6>Etat du contrat: &nbsp;<span>Avenant</span></h6>
        <div class="row">
          <div class="col-lg-3 form-group mt-4">
            <label for="">N° Avenant</label>
            <input
              type="text"
              class="form-control rounded-pill"
              formControlName="etat_contrat_n_avenant"
              readonly
            />
          </div>

          <div class="col-lg-3 form-group mt-4">
            <label for="">Pièce jointe</label>
            <input
              type="file"
              class="form-control rounded-pill btn success-btn"
              formControlName="etat_contrat_piece_jointe_avenant"
              accept=".pdf"
              (change)="onFileSelected($event, 'piece_jointe_avenant')"
            />
          </div>

          <div class="col-lg-3 form-group mt-4">
            <label for="">Date d’effet de l’avenant</label>
            <input
              type="date"
              class="form-control rounded-pill"
              (change)="reinitialiserDateDebut()"
              formControlName="date_effet_av"
              required
            />
          </div>

          <!-- <div class="col-lg-3 form-group mt-4">
            <label for="">Motif</label>
             <input type="text" class="form-control rounded-pill" formControlName="etat_contrat_motif">
            <select
              class="form-select rounded-pill"
              formControlName="etat_contrat_motif"
            >
              <option value="Décès">Décès</option>
              <option value="Cession">Cession</option>
              <option value="Révision_prix_loyer">
                Révision du prix du loyer
              </option>
            </select>
          </div> -->

          <!-- <div class="col-lg-3 form-group mt-4">
            <label for="">Montant du nouveau loyer</label>
            <input
              type="number"
              class="form-control rounded-pill"
              formControlName="etat_contrat_montant_nouveau_loyer"
            />
          </div> -->

          <div class="row form-group mt-4">
            <label for="">Motif</label>
            <div class="col-lg-3">
              <input
                type="checkbox"
                id="deces"
                class="btn-check check"
                (click)="displayForms('deces')"
                autocomplete="off"
              />
              <label
                class="px-3 py-1 rounded-pill checkbox-list-btns text-center w-100"
                for="deces"
                >Décès</label
              >
            </div>
            <div class="col-lg-3">
              <input
                type="checkbox"
                class="btn-check check"
                id="cession"
                (click)="displayForms('cession')"
                autocomplete="off"
              />
              <label
                class="px-3 py-1 rounded-pill checkbox-list-btns text-center w-100"
                for="cession"
                >Cession</label
              >
            </div>
            <div class="col-lg-3">
              <input
                type="checkbox"
                class="btn-check check"
                id="revison_mnt_loyer"
                (click)="displayForms('revison_mnt_loyer')"
                autocomplete="off"
              />
              <label
                class="px-3 py-1 rounded-pill checkbox-list-btns text-center w-100"
                for="revison_mnt_loyer"
                >Révision du prix du loyer</label
              >
            </div>
            <!-- <input type="text" class="form-control rounded-pill" formControlName="etat_contrat_motif"> -->
          </div>

          <div
            *ngIf="
              proprDecesFormList || proprCessionFormList;
              then ListProprietaires
            "
          ></div>
          <div *ngIf="montantLoyerForm; then MontantLoyer"></div>
          <!-- List proprietaire  -->
          <ng-template #ListProprietaires>
            <div class="py-5 mt-2">
              <table class="table">
                <thead>
                  <tr>
                    <th>Nom complet</th>
                    <th>Raison social</th>
                    <th>CIN</th>
                    <th>Mandataire</th>
                    <th>Actions</th>
                  </tr>
                </thead>

                <tbody *ngIf="proprietaires?.length">
                  <tr *ngFor="let proprietaire of proprietaires">
                    <!-- <td>{{ proprietaire._id }}</td> -->
                    <td>
                      {{
                        proprietaire.nom_prenom ? proprietaire.nom_prenom : "--"
                      }}
                    </td>
                    <td>
                      {{
                        proprietaire.raison_social
                          ? proprietaire.raison_social
                          : "--"
                      }}
                    </td>
                    <td>{{ proprietaire.cin }}</td>
                    <td>
                      <div class="d-grid">
                        <span
                          class="p-1"
                          [ngClass]="{
                            'success-txt': proprietaire?.is_mandataire,
                            'danger-txt': !proprietaire?.is_mandataire
                          }"
                        >
                          {{ checkAndPutText(proprietaire.is_mandataire) }}
                        </span>
                      </div>
                    </td>
                    <td>
                      <a
                        class="btn btn-sm danger-btn"
                        (click)="openDeleteConfirmationModal(proprietaire?._id)"
                        ><i class="far fa-user-minus"></i
                      ></a>
                    </td>
                  </tr>

                  <app-confirmation-modal [closeBtn]="true" [id]="id">
                    <h3 class="main-title">
                      Confirmation de la supression
                      <i class="far fa-exclamation-circle"></i>
                    </h3>
                    <p class="mt-3">Voulez-vous supprimer ce propriétaire?</p>
                    <div class="d-inline-flex justify-content-start mt-5">
                      <a
                        class="btn btn-lg px-lg-4 danger-btn me-2"
                        (click)="deleteProprietaire()"
                        >Oui</a
                      >
                      <a
                        class="btn btn-lg px-lg-4 main-btn"
                        (click)="closeDeleteConfirmationModal()"
                        >Non</a
                      >
                    </div>
                  </app-confirmation-modal>
                </tbody>

                <tbody
                  *ngIf="!proprietaires?.length"
                  class="w-100 d-flex align-items-center"
                >
                  <h5 class="main-muted-text my-4">
                    Aucun proprietaire à afficher
                  </h5>
                </tbody>
              </table>
            </div>
          </ng-template>

          <ng-template #MontantLoyer>
            <div class="col-lg-3 form-group mt-4">
              <label for="">Montant du nouveau loyer</label>
              <input
                type="number"
                class="form-control rounded-pill"
                formControlName="etat_contrat_montant_nouveau_loyer"
              />
            </div>
          </ng-template>
        </div>
      </ng-template>
      <!-- Template Avenant end -->

      <!-- Template Suspendu start -->
      <ng-template #SUS>
        <h6>Etat du contrat: &nbsp;<span>Suspendu</span></h6>
        <div class="row">
          <div class="col-lg-3 form-group mt-4">
            <label for="">Intitulé de d'entité</label>
            <input
              type="text"
              class="form-control rounded-pill"
              formControlName="etat_contrat_intitule_lieu"
              readonly
            />
          </div>

          <div class="col-lg-3 form-group mt-4">
            <label for=""
              >Date de suspension <span class="danger-txt">*</span></label
            >
            <input
              type="date"
              class="form-control rounded-pill"
              formControlName="etat_contrat_date_suspension"
              [ngClass]="{
                'is-invalid': checkInputsValidation(
                  etat_contrat_date_suspension
                ),
                'is-valid': !etat_contrat_date_suspension?.invalid
              }"
            />

            <!-- Error Message  -->
            <div
              class=""
              *ngIf="checkInputsValidation(etat_contrat_date_suspension)"
            >
              <p
                class="danger-txt"
                *ngIf="etat_contrat_date_suspension?.errors?.required"
              >
                Veuillez remplir ce champ
              </p>
            </div>
          </div>

          <div class="col-lg-3 form-group mt-4">
            <label for="">Durée de suspension</label>
            <input
              type="number"
              class="form-control rounded-pill"
              formControlName="etat_contrat_duree_suspension"
            />
          </div>

          <div class="col-lg-3 form-group mt-4">
            <label for="">Motif de suspension</label>
            <input
              type="text"
              class="form-control rounded-pill"
              formControlName="etat_contrat_motif_suspension"
            />
          </div>
        </div>
      </ng-template>
      <!-- Template Suspendu end -->

      <!-- Template Resiliation start -->
      <ng-template #RES>
        <h6>Etat du contrat: &nbsp;<span>Résilié</span></h6>

        <div class="row">
          <div class="col-lg-3 form-group mt-4">
            <label for="">Intitulé de d'entité</label>
            <input
              type="text"
              class="form-control rounded-pill"
              formControlName="etat_contrat_intitule_lieu"
              readonly
            />
          </div>

          <div class="col-lg-3 form-group mt-4">
            <label for="">Statut de la caution </label>
            <!-- <input type="text" class="form-control rounded-pill" formControlName="etat_contrat_reprise_caution"> -->
            <select
              class="form-select rounded-pill"
              formControlName="etat_contrat_reprise_caution"
              [(ngModel)]="repriseCaution"
            >
              <option value="Consommée">Consommée</option>
              <option value="Récupérée">Récupérée</option>
            </select>
          </div>

          <div
            class="col-lg-3 form-group mt-4"
            *ngIf="repriseCaution === 'Consommée'"
          >
            <label for="">Etat caution consommée</label>
            <select
              class="form-select rounded-pill"
              formControlName="etat_caution_consomme"
              [(ngModel)]="cautionConsommee"
            >
              <option value="Partial">Partielle</option>
              <option value="totale">Totale</option>
            </select>
          </div>

          <div
            class="row"
            *ngIf="
              cautionConsommee === 'Partial' && repriseCaution === 'Consommée'"
          >
            <div class="col-lg-3 form-group mt-4">
              <label for="">Durée consommée</label>
              <input
                type="number"
                class="form-control rounded-pill"
                formControlName="duree_consomme"
                (keyup)="calculCautionDurreeRecuperer()"
              />
            </div>

            <div class="col-lg-3 form-group mt-4">
              <label for="">Durée à récupérer</label>
              <input
                type="number"
                class="form-control rounded-pill"
                formControlName="duree_a_recupere"
                [value]="durreeRecuperer"
                readonly
              />
              <p class="danger-txt" *ngIf="hasErrordurreeRecuperer">
                Attention! la durée à récupérer doit être un nombre positive
              </p>
            </div>
          </div>

          <div class="col-lg-3 form-group mt-4">
            <label for=""
              >Date de résiliation <span class="danger-txt">*</span></label
            >
            <input
              type="date"
              class="form-control rounded-pill"
              formControlName="etat_contrat_date_resiliation"
              [(ngModel)]="dateResiliation"
              (change)="calculPreavis()"
              [ngClass]="{
                'is-invalid': checkInputsValidation(
                  etat_contrat_date_resiliation
                ),
                'is-valid': !etat_contrat_date_resiliation?.invalid
              }"
            />
            <!-- Error Message  -->
            <div
              class=""
              *ngIf="checkInputsValidation(etat_contrat_date_resiliation)"
            >
              <p
                class="danger-txt"
                *ngIf="etat_contrat_date_resiliation?.errors?.required"
              >
                Veuillez remplir ce champ
              </p>
            </div>
          </div>

          <div class="col-lg-3 form-group mt-4">
            <label for="">Préavis</label>
            <input
              type="date"
              class="form-control rounded-pill"
              [value]="date_preavis"
              formControlName="etat_contrat_preavis"
              readonly
            />
          </div>

          <div class="col-lg-3 form-group mt-4">
            <label for="">Etat des lieux de sortie</label>
            <input
              type="text"
              class="form-control rounded-pill"
              formControlName="etat_contrat_etat_lieu_sortie"
            />
          </div>

          <div class="col-lg-3 form-group mt-4">
            <label for="">Images d'état des lieux de sortie</label>
            <input
              type="file"
              class="form-control btn success-btn"
              formControlName="etat_contrat_images_etat_res_lieu_sortie"
              accept=".pdf"
              (change)="onFileSelected($event, 'images_etat_res_lieu_sortie')"
              multiple
            />
          </div>

          <div class="col-lg-3 form-group mt-4">
            <label for=""
              >Piéce jointe (la lettre de résiliation scannée)</label
            >
            <input
              type="file"
              class="form-control btn success-btn"
              formControlName="etat_contrat_lettre_res_piece_jointe"
              accept=".pdf"
              (change)="onFileSelected($event, 'lettre_res_piece_jointe')"
            />
          </div>
        </div>
      </ng-template>
      <!-- Template Resiliation end -->
    </div>

    <!-- Button Ajouter -->
    <div class="form-group mt-5 col-lg-4 d-flex">
      <button
        *ngIf="!update"
        type="submit"
        id="Ajouter"
        class="btn second-btn form-control"
        (click)="addNewContrat(); scrollToTop()"
      >
        Ajouter
      </button>
      <button
        *ngIf="update"
        type="submit"
        id="Modifier"
        class="btn second-btn form-control"
        (click)="openResiliationModel(); scrollToTop()"
      >
        Modifier
      </button>
    </div>
  </form>

  <app-confirmation-modal [closeBtn]="true" [id]="id">
    <div *ngIf="updateDone" class="done-alert p-2 my-3">{{ updateSucces }}</div>
    <div *ngIf="errors" class="error-alert p-2 my-2">{{ errors }}</div>
    <h3 class="main-title">
      Confirmation de la résiliation <i class="far fa-exclamation-circle"></i>
    </h3>
    <p class="mt-3">Êtes-vous de vouloir résilier le contrat ?</p>
    <div class="d-inline-flex justify-content-start mt-5">
      <a class="btn btn-lg px-lg-4 danger-btn me-2" (click)="updateContrat()"
        >Résilier</a
      >
      <a class="btn btn-lg px-lg-4 main-btn" (click)="closeConfirmationModal()"
        >Annuler</a
      >
    </div>
  </app-confirmation-modal>
  <!-- Fin de formulaire-->
</div>
