<div class="row title">
  <div class="col-lg-12 mt-3">
    <div class="d-flex justify-content-between">
      <!-- <h3 class=""></h3> -->
      <h3 class="main-title">Liste des locaux</h3>
      <div class="d-none d-lg-block">
        <a class="btn btn-sm success-btn" [routerLink]="['/foncier']">
          <i class="fal fa-plus-octagon"></i> Nouveau locale
        </a>
        <a class="btn btn-sm second-btn mx-3" (click)="reload()"
          ><i class="far fa-undo-alt"></i>
          Rafraîchir la liste
        </a>
        <span
          data-bs-toggle="tooltip"
          data-bs-placement="top"
          title="Ici vous pouvez consulter la list des fonciers"
        >
          <i class="fal fa-info"></i>
        </span>
      </div>
    </div>
  </div>
</div>

<div class="w-100 d-flex justify-content-center">
  <div *ngIf="deleteDone" class="done-alert p-2 my-2">{{ deleteSucces }}</div>
  <div *ngIf="errors" class="error-alert p-2 my-2">{{ errors }}</div>
</div>

<div class="main-card bg-white table-responsive p-lg-3 mt-4">
  <div class="row d-flex justify-content-between ">
    <div class="col-lg-4 mb-4">
      <label for="" class="main-muted-text"><i class="far fa-search"></i> Recherche</label>
      <input type="text" [(ngModel)]="findFoncier" (input)="search()" class="form-control rounded-pill"
        placeholder="Rechercher par intitulé/ville..." />
    </div>

    <div class="d-flex justify-content-end col-lg-7 my-4">
      <div class="">
        <input id="all" type="radio" name="search-by-amenagement" (click)="searchByAmenagement($event, 'all')"
          class="btn-check check" [checked]='true' autocomplete="off" />
        <label class="px-3 rounded-pill checkbox-list-btns" for="all">Tout</label>
      </div>

      <div class="">
        <input id="oui" type="radio" name="search-by-amenagement" class="btn-check check"
          (click)="searchByAmenagement($event, 'true')" autocomplete="off" />
        <label class="px-3  mx-2 rounded-pill checkbox-list-btns" for="oui"> Avec aménagement</label>
      </div>
      <div class="col-sm-4">
        <input id="non" type="radio" name="search-by-amenagement" (click)="searchByAmenagement($event, 'false')"
          class="btn-check check" autocomplete="off" />
        <label class="px-3  rounded-pill checkbox-list-btns" for="non"> Sans aménagement</label>
      </div>
    </div>
  </div>

  <table class="table">
    <thead>
      <tr class="text-truncate">
        <th>Type</th>
        <th>Ville</th>
        <th>Aménagement</th>
        <th>Propriétaires</th>
        <th>Contrat</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody *ngIf="fonciers.length">
      <tr
        *ngFor="
          let foncier of fonciers
            | paginate
              : {
                  itemsPerPage: tableSize,
                  currentPage: listFoncierPage,
                  id: 'listFoncierPagination',
                  totalItems: count
                }
        "
      >
        <td>{{ foncier.type }}</td>
        <td>{{ foncier.ville }}</td>
        <td>
          <div class="d-grid">
            <span class="p-1" [ngClass]="{
                'success-txt': foncier.has_amenagements,
                'danger-txt': !foncier.has_amenagements
              }">
              {{ checkAndPutText(foncier?.has_amenagements) }}
            </span>
          </div>
        </td>

        <td>
          <div *ngIf="foncier.has_contrat">

            <div *ngIf="foncier.proprietaire.length">
              <span class="col-sm-6 danger-txt">
                {{
                  foncier.proprietaire.length >= 1 ? foncier.proprietaire.length : ""
                }}
                propriétaire<span *ngIf="foncier.proprietaire.length > 1">s</span>
              </span>
              <span class="mx-1 text-secondary"> • </span>
              <a
                [routerLink]="['/proprietaire', foncier._id]"
                class="short-link success-txt"
              >
                Ajouter un autre</a
              >
            </div>
  
            <a
              *ngIf="!foncier.proprietaire.length"
              [routerLink]="['/proprietaire', foncier._id]"
              class="btn btn-sm success-btn"
              >Ajouter un propriétaire</a
            >
          </div>
          <p *ngIf="!foncier.has_contrat" class="info-txt">
            Vous devez créer un contrat avant d'ajouter un proprietaire
          </p>
        </td>

          <td>
          <p *ngIf="foncier.has_contrat" class="info-txt">
            Ce local contient un contrat
          </p>
          <a *ngIf="!foncier.has_contrat" [routerLink]="['/contrat', foncier._id]" class="btn btn-sm success-btn">Ajouter un
            contrat</a>
        </td>

        <td>
          <div class="btn-group" role="group">
            <a id="btnGroupDrop1" class="btn" data-bs-toggle="dropdown" aria-expanded="false">
              <h4>
                <i class="fal fa-ellipsis-v-alt"></i>
              </h4>
            </a>
            <ul class="dropdown-menu p-3 main-card border-0" id="actions" aria-labelledby="btnGroupDrop1">
              <li>
                <h5 class="main-title">Actions</h5>
                <div class="d-flex">
                  <a [routerLink]="['list', foncier._id]" class="btn btn-sm main-btn"><i class="fal fa-eye"></i></a>
                  <a class="btn btn-sm info-btn mx-2" (click)="openModalAndPushFoncier(foncier)"><i
                      class="far fa-user-edit"></i></a>
                  <a class="btn btn-sm danger-btn" (click)="openConfirmationModal(foncier)"><i
                      class="far fa-user-minus"></i></a>
                </div>
              </li>
            </ul>
          </div>
        </td>
      </tr>

      <pagination-controls
        id="listFoncierPagination"
        (pageChange)="listFoncierPage = $event"
        previousLabel="Précédent"
        nextLabel="Suivant"
      >
      </pagination-controls>

      <app-main-modal [closeBtn]="true">
        <edit-foncier [foncier]="targetFoncier"> </edit-foncier>
      </app-main-modal>

      <app-confirmation-modal [closeBtn]="true">
        <h3 class="main-title">
          Confirmation de la supression
          <i class="far fa-exclamation-circle"></i>
        </h3>
        <p class="mt-3">Voulez-vous supprimer ce foncier?</p>
        <div class="d-inline-flex justify-content-start mt-5">
          <a
            class="btn btn-lg px-lg-4 danger-btn me-2"
            (click)="deleteFoncier()"
            >Oui</a
          >
          <a
            class="btn btn-lg px-lg-4 main-btn"
            (click)="closeConfirmationModal()"
            >Non</a
          >
        </div>
      </app-confirmation-modal>
    </tbody>

    <tbody
      *ngIf="!fonciers.length && !accessError"
      class="w-100 d-flex align-items-center"
    >
      <h5 class="main-muted-text my-4">Aucun locale à afficher</h5>
      <a class="btn btn-sm second-btn ms-3" [routerLink]="['/foncier']">
        + Nouveau locale
      </a>
    </tbody>

    <tbody *ngIf="accessError" class="w-100 d-flex align-items-center">
      <h5 class="danger-txt my-4">{{ accessError }}</h5>
      <a class="btn btn-sm second-btn ms-3" [routerLink]="['/']">
        <i class="far fa-chevron-left"></i> Retour au tablau de bors
      </a>
    </tbody>
  </table>
</div>
